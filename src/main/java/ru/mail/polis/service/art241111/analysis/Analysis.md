Анализ полученных результатов
================
Запрос PUT 
----------------
### Нагрузочное тестирование с помощью wrk в одно соединение
**Запрос:** wrk -t1 -c1 -d5m -R2000 -s put.lua --latency  http://127.0.0.1:8080

Running 5m test @ http://127.0.0.1:8080. 1 threads and 1 connections
  
  Thread calibration: mean lat.: 3.124ms, rate sampling interval: 10ms
  
  Thread Stats |  Avg      |Stdev    | Max    | +/- Stdev
  -------------|-----------|---------|--------|------------
    Latency    | 192.78ms  |884.19ms |  6.45s |   95.10%
    Req/Sec    | 2.18k     |1.04k    | 14.89k |   90.87%

  Latency    |Distribution (HdrHistogram - Recorded Latency)
  -----------|----------------------------------------------
   50.000%   | 1.60ms
   75.000%   | 2.48ms
   90.000%   | 5.52ms
   99.000%   | 5.37s 
   99.900%   | 6.31s 
   99.990%   | 6.43s 
   99.999%   | 6.45s 
   100.000%  |  6.45s 

  **Detailed Percentile spectrum:**
```
     Value   Percentile   TotalCount 1/(1-Percentile)
     0.032     0.000000            1         1.00
     0.477     0.100000        59176         1.11
     0.823     0.200000       118386         1.25
     1.094     0.300000       177597         1.43
     1.333     0.400000       236837         1.67
     1.597     0.500000       295825         2.00
     1.740     0.550000       325473         2.22
     1.895     0.600000       355070         2.50
     2.057     0.650000       384724         2.86
     2.247     0.700000       414327         3.33
     2.481     0.750000       443734         4.00
     2.631     0.775000       458625         4.44
     2.817     0.800000       473277         5.00
     3.067     0.825000       488138         5.71
     3.437     0.850000       502870         6.67
     4.127     0.875000       517668         8.00
     4.691     0.887500       525039         8.89
     5.527     0.900000       532459        10.00
     6.887     0.912500       539833        11.43
     9.703     0.925000       547224        13.33
    43.519     0.937500       554617        16.00
   340.735     0.943750       558314        17.78
   969.215     0.950000       562012        20.00
  1650.687     0.956250       565710        22.86
  2340.863     0.962500       569407        26.67
  3043.327     0.968750       573104        32.00
  3397.631     0.971875       574961        35.56
  3745.791     0.975000       576800        40.00
  4089.855     0.978125       578656        45.71
  4419.583     0.981250       580505        53.33
  4771.839     0.984375       582369        64.00
  4919.295     0.985938       583274        71.11
  5087.231     0.987500       584202        80.00
  5263.359     0.989062       585136        91.43
  5439.487     0.990625       586050       106.67
  5603.327     0.992188       586973       128.00
  5689.343     0.992969       587459       142.22
  5763.071     0.993750       587902       160.00
  5820.415     0.994531       588378       182.86
  5898.239     0.995313       588818       213.33
  5988.351     0.996094       589286       256.00
  6033.407     0.996484       589520       284.44
  6078.463     0.996875       589754       320.00
  6115.327     0.997266       589975       365.71
  6160.383     0.997656       590215       426.67
  6205.439     0.998047       590448       512.00
  6225.919     0.998242       590556       568.89
  6250.495     0.998437       590689       640.00
  6270.975     0.998633       590797       731.43
  6291.455     0.998828       590904       853.33
  6311.935     0.999023       591012      1024.00
  6324.223     0.999121       591076      1137.78
  6336.511     0.999219       591139      1280.00
  6348.799     0.999316       591204      1462.86
  6356.991     0.999414       591246      1706.67
  6369.279     0.999512       591311      2048.00
  6373.375     0.999561       591332      2275.56
  6381.567     0.999609       591375      2560.00
  6385.663     0.999658       591394      2925.71
  6393.855     0.999707       591416      3413.33
  6406.143     0.999756       591453      4096.00
  6410.239     0.999780       591463      4551.11
  6414.335     0.999805       591474      5120.00
  6422.527     0.999829       591505      5851.43
  6422.527     0.999854       591505      6826.67
  6426.623     0.999878       591526      8192.00
  6426.623     0.999890       591526      9102.22
  6430.719     0.999902       591538     10240.00
  6434.815     0.999915       591549     11702.86
  6434.815     0.999927       591549     13653.33
  6438.911     0.999939       591560     16384.00
  6438.911     0.999945       591560     18204.44
  6443.007     0.999951       591572     20480.00
  6443.007     0.999957       591572     23405.71
  6443.007     0.999963       591572     27306.67
  6443.007     0.999969       591572     32768.00
  6447.103     0.999973       591583     36408.89
  6447.103     0.999976       591583     40960.00
  6447.103     0.999979       591583     46811.43
  6447.103     0.999982       591583     54613.33
  6447.103     0.999985       591583     65536.00
  6447.103     0.999986       591583     72817.78
  6447.103     0.999988       591583     81920.00
  6447.103     0.999989       591583     93622.86
  6451.199     0.999991       591589    109226.67
  6451.199     1.000000       591589          inf
```

[Mean    =      192.780, StdDeviation   =      884.188]   
[Max     =     6447.104, Total count    =       591589]  
[Buckets =           27, SubBuckets     =         2048]  


599999 requests in 5.00m, 38.34MB read  
Socket errors: connect 0, read 0, write 0, timeout 4  
Requests/sec:   1999.99  
Transfer/sec:    130.86KB  

###Профилирование CPU под нагрузкой 
**Команда** /profiler.sh -d 60 -f cpu_put.svg -e cpu  3689
![async-profiler put cpu](cpu_put.svg)

### Профилирование ALLOC под нагрузкой 
**Команда** /profiler.sh -d 60 -f alloc_put.svg -e alloc  3689
![async-profiler put alloc](alloc_put.svg)

### Анализ
При рассмотрении профилирования CPU видно, что 80,15% уходит на SelectorThread, 
из них 2% уходит на парсинг запроса, на команду put уходит 14,66%, из них 12,67% уходит
на логгирование, а значит, что если его убрать, то загрузка CPU уменьшиться. Также 41,37% уходит
на отправку ответа (SendResponse).

При рассмотрении профилирования ALLOC видно, что поток Thread (39,78%) уходит
на поддержание TCP соединения. Оставшиеся 59,21% уходит на наш сервер. Из них
47,97% уходит на парсинг запроса (в том числе около 5% уходит на UTF8.read).
Также стоит отменить, что на графике видно, что логгер занимает больше, чем сам запрос
в БД.

В результате можно сделать вывод, что на данный момент - основной способ ускорения сервера -
отключение логгера. 

------------------------
## Запрос GET
### Нагрузочное тестирование с помощью wrk в одно соединение
**Запрос:** wrk -t1 -c1 -d5m -R2000 -s get.lua --latency  http://127.0.0.1:8080
Running 5m test @ http://127.0.0.1:8080  
  1 threads and 1 connections  
  Thread calibration: mean lat.: 1323.660ms, rate sampling interval: 3457ms  
  
  Thread Stats |  Avg  |    Stdev  |   Max  | +/- Stdev
  -------------|-------|-----------|--------|------------
    Latency    | 2.56s |    1.37s  |  4.83s |   54.46%
    Req/Sec    | 1.99k |  154.04   |  2.41k |   67.47%
    
  Latency   | Distribution (HdrHistogram - Recorded Latency)
  ----------|--------------------------------------
   50.000%  |   2.67s 
   75.000%  |   3.92s 
   90.000%  |   4.34s 
   99.000%  |   4.73s 
   99.900%  |   4.82s 
   99.990%  |   4.83s 
   99.999%  |   4.83s 
  100.000%  |   4.83s 

  **Detailed Percentile spectrum:**
  ```
       Value   Percentile   TotalCount 1/(1-Percentile)
       0.253     0.000000            1         1.00
     614.399     0.100000        57836         1.11
    1095.679     0.200000       115685         1.25
    1630.207     0.300000       173626         1.43
    2463.743     0.400000       231523         1.67
    2668.543     0.500000       289190         2.00
    2740.223     0.550000       318513         2.22
    2869.247     0.600000       347044         2.50
    3071.999     0.650000       375947         2.86
    3627.007     0.700000       404865         3.33
    3923.967     0.750000       433804         4.00
    4014.079     0.775000       448500         4.44
    4089.855     0.800000       462807         5.00
    4141.055     0.825000       477137         5.71
    4190.207     0.850000       491685         6.67
    4276.223     0.875000       506738         8.00
    4308.991     0.887500       513681         8.89
    4337.663     0.900000       520633        10.00
    4370.431     0.912500       527764        11.43
    4407.295     0.925000       534995        13.33
    4468.735     0.937500       542460        16.00
    4485.119     0.943750       547317        17.78
    4493.311     0.950000       549621        20.00
    4505.599     0.956250       553311        22.86
    4521.983     0.962500       557364        26.67
    4534.271     0.968750       560458        32.00
    4542.463     0.971875       562542        35.56
    4550.655     0.975000       564428        40.00
    4558.847     0.978125       565815        45.71
    4603.903     0.981250       567492        53.33
    4640.767     0.984375       569267        64.00
    4661.247     0.985938       570276        71.11
    4669.439     0.987500       571130        80.00
    4706.303     0.989062       572002        91.43
    4739.071     0.990625       572909       106.67
    4755.455     0.992188       573807       128.00
    4759.551     0.992969       574283       142.22
    4763.647     0.993750       574865       160.00
    4767.743     0.994531       575160       182.86
    4780.031     0.995313       575585       213.33
    4796.415     0.996094       576186       256.00
    4800.511     0.996484       576475       284.44
    4804.607     0.996875       576800       320.00
    4804.607     0.997266       576800       365.71
    4808.703     0.997656       577235       426.67
    4808.703     0.998047       577235       512.00
    4812.799     0.998242       577697       568.89
    4812.799     0.998437       577697       640.00
    4812.799     0.998633       577697       731.43
    4812.799     0.998828       577697       853.33
    4816.895     0.999023       577925      1024.00
    4816.895     0.999121       577925      1137.78
    4816.895     0.999219       577925      1280.00
    4816.895     0.999316       577925      1462.86
    4820.991     0.999414       578137      1706.67
    4820.991     0.999512       578137      2048.00
    4820.991     0.999561       578137      2275.56
    4820.991     0.999609       578137      2560.00
    4820.991     0.999658       578137      2925.71
    4820.991     0.999707       578137      3413.33
    4825.087     0.999756       578263      4096.00
    4825.087     0.999780       578263      4551.11
    4825.087     0.999805       578263      5120.00
    4825.087     0.999829       578263      5851.43
    4825.087     0.999854       578263      6826.67
    4825.087     0.999878       578263      8192.00
    4825.087     0.999890       578263      9102.22
    4825.087     0.999902       578263     10240.00
    4825.087     0.999915       578263     11702.86
    4825.087     0.999927       578263     13653.33
    4825.087     0.999939       578263     16384.00
    4825.087     0.999945       578263     18204.44
    4825.087     0.999951       578263     20480.00
    4829.183     0.999957       578288     23405.71
    4829.183     1.000000       578288          inf
```

[Mean    =     2562.066, StdDeviation   =     1368.121]  
[Max     =     4825.088, Total count    =       578288]  
[Buckets =           27, SubBuckets     =         2048]  

594705 requests in 5.00m, 41.85MB read  
Requests/sec:   1982.35  
Transfer/sec:    142.86KB  

###Профилирование CPU под нагрузкой 
**Команда** /profiler.sh -d 60 -f cpu_get.svg -e cpu  3689
![async-profiler get cpu](cpu_get.svg)

### Профилирование ALLOC под нагрузкой 
**Команда** /profiler.sh -d 60 -f alloc_get.svg -e alloc  3689
![async-profiler get alloc](alloc_get.svg)

### Анализ
При рассмотрении профилирования CPU видно, что 99,23% уходит на SelectorThread, на отправку ответа 
уходит 33,3%, оставшиеся 63,20% уходят на обработку запроса GET. В этом случае на логгирование уходит 
14,79%. Оставшиеся 48,13% уходят на итерирование в БД. 

При рассмотрении профилирования ALLOC видно, что поток Thread (27,82%) уходит
на поддержание TCP соединения. Оставшиеся 72,18% уходит на наш сервер.
На графике ALLOC, так же как и в случае CPU, большая часть ресурсов уходит на 
итерирование по БД 

В результате можно сделать вывод, что на данный момент - основной способ ускорения сервера -
оптимизация итератора и удаление логгера. 